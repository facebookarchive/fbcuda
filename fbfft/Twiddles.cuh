// Copyright 2004-present Facebook. All Rights Reserved.

#pragma once

#include "cuda/Complex.cuh"

namespace facebook { namespace cuda { namespace fbfft {

namespace {

static const int kNumTwiddles = 256;

// __device__, __shared__ and __constant__ variables cannot be defined as
// external using the extern keyword. The only exception is for dynamically
// allocated __shared__ variables as described in Section B.2.3.
//
// Putting everything in an anon namespace, each .cu scope has its own
// array in global memory, and its own single time initialization.
//
// This is minor overhead.
//
float __device__ twiddleFactors[kNumTwiddles * 2];

// Obtained by running the following in octave
// format('long')
// x = exp(- 2i *pi * [0:255]' / 256)
const float twiddleFactorsHost[kNumTwiddles * 2] = {
   1.000000000000000, -0.000000000000000,
   0.999698818696204, -0.024541228522912,
   0.998795456205172, -0.049067674327418,
   0.997290456678690, -0.073564563599667,
   0.995184726672197, -0.098017140329561,
   0.992479534598710, -0.122410675199216,
   0.989176509964781, -0.146730474455362,
   0.985277642388941, -0.170961888760301,
   0.980785280403230, -0.195090322016128,
   0.975702130038529, -0.219101240156870,
   0.970031253194544, -0.242980179903264,
   0.963776065795440, -0.266712757474898,
   0.956940335732209, -0.290284677254462,
   0.949528180593037, -0.313681740398892,
   0.941544065183021, -0.336889853392220,
   0.932992798834739, -0.359895036534988,
   0.923879532511287, -0.382683432365090,
   0.914209755703531, -0.405241314004990,
   0.903989293123443, -0.427555093430282,
   0.893224301195515, -0.449611329654607,
   0.881921264348355, -0.471396736825998,
   0.870086991108711, -0.492898192229784,
   0.857728610000272, -0.514102744193222,
   0.844853565249707, -0.534997619887097,
   0.831469612302545, -0.555570233019602,
   0.817584813151584, -0.575808191417845,
   0.803207531480645, -0.595699304492433,
   0.788346427626606, -0.615231590580627,
   0.773010453362737, -0.634393284163645,
   0.757208846506485, -0.653172842953777,
   0.740951125354959, -0.671558954847018,
   0.724247082951467, -0.689540544737067,
   0.707106781186548, -0.707106781186547,
   0.689540544737067, -0.724247082951467,
   0.671558954847018, -0.740951125354959,
   0.653172842953777, -0.757208846506484,
   0.634393284163645, -0.773010453362737,
   0.615231590580627, -0.788346427626606,
   0.595699304492433, -0.803207531480645,
   0.575808191417845, -0.817584813151584,
   0.555570233019602, -0.831469612302545,
   0.534997619887097, -0.844853565249707,
   0.514102744193222, -0.857728610000272,
   0.492898192229784, -0.870086991108711,
   0.471396736825998, -0.881921264348355,
   0.449611329654607, -0.893224301195515,
   0.427555093430282, -0.903989293123443,
   0.405241314004990, -0.914209755703531,
   0.382683432365090, -0.923879532511287,
   0.359895036534988, -0.932992798834739,
   0.336889853392220, -0.941544065183021,
   0.313681740398892, -0.949528180593037,
   0.290284677254462, -0.956940335732209,
   0.266712757474898, -0.963776065795440,
   0.242980179903264, -0.970031253194544,
   0.219101240156870, -0.975702130038529,
   0.195090322016128, -0.980785280403230,
   0.170961888760301, -0.985277642388941,
   0.146730474455362, -0.989176509964781,
   0.122410675199216, -0.992479534598710,
   0.098017140329561, -0.995184726672197,
   0.073564563599667, -0.997290456678690,
   0.049067674327418, -0.998795456205172,
   0.024541228522912, -0.999698818696204,
   0.000000000000000, -1.000000000000000,
  -0.024541228522912, -0.999698818696204,
  -0.049067674327418, -0.998795456205172,
  -0.073564563599667, -0.997290456678690,
  -0.098017140329561, -0.995184726672197,
  -0.122410675199216, -0.992479534598710,
  -0.146730474455362, -0.989176509964781,
  -0.170961888760301, -0.985277642388941,
  -0.195090322016128, -0.980785280403230,
  -0.219101240156870, -0.975702130038529,
  -0.242980179903264, -0.970031253194544,
  -0.266712757474898, -0.963776065795440,
  -0.290284677254462, -0.956940335732209,
  -0.313681740398891, -0.949528180593037,
  -0.336889853392220, -0.941544065183021,
  -0.359895036534988, -0.932992798834739,
  -0.382683432365090, -0.923879532511287,
  -0.405241314004990, -0.914209755703531,
  -0.427555093430282, -0.903989293123443,
  -0.449611329654607, -0.893224301195515,
  -0.471396736825998, -0.881921264348355,
  -0.492898192229784, -0.870086991108711,
  -0.514102744193222, -0.857728610000272,
  -0.534997619887097, -0.844853565249707,
  -0.555570233019602, -0.831469612302545,
  -0.575808191417845, -0.817584813151584,
  -0.595699304492433, -0.803207531480645,
  -0.615231590580627, -0.788346427626606,
  -0.634393284163645, -0.773010453362737,
  -0.653172842953777, -0.757208846506485,
  -0.671558954847018, -0.740951125354959,
  -0.689540544737067, -0.724247082951467,
  -0.707106781186547, -0.707106781186548,
  -0.724247082951467, -0.689540544737067,
  -0.740951125354959, -0.671558954847019,
  -0.757208846506485, -0.653172842953777,
  -0.773010453362737, -0.634393284163645,
  -0.788346427626606, -0.615231590580627,
  -0.803207531480645, -0.595699304492433,
  -0.817584813151584, -0.575808191417845,
  -0.831469612302545, -0.555570233019602,
  -0.844853565249707, -0.534997619887097,
  -0.857728610000272, -0.514102744193222,
  -0.870086991108711, -0.492898192229784,
  -0.881921264348355, -0.471396736825998,
  -0.893224301195515, -0.449611329654607,
  -0.903989293123443, -0.427555093430282,
  -0.914209755703531, -0.405241314004990,
  -0.923879532511287, -0.382683432365090,
  -0.932992798834739, -0.359895036534988,
  -0.941544065183021, -0.336889853392220,
  -0.949528180593037, -0.313681740398891,
  -0.956940335732209, -0.290284677254462,
  -0.963776065795440, -0.266712757474898,
  -0.970031253194544, -0.242980179903264,
  -0.975702130038528, -0.219101240156870,
  -0.980785280403230, -0.195090322016129,
  -0.985277642388941, -0.170961888760301,
  -0.989176509964781, -0.146730474455362,
  -0.992479534598710, -0.122410675199216,
  -0.995184726672197, -0.098017140329561,
  -0.997290456678690, -0.073564563599668,
  -0.998795456205172, -0.049067674327418,
  -0.999698818696204, -0.024541228522912,
  -1.000000000000000, -0.000000000000000,
  -0.999698818696204, 0.024541228522912,
  -0.998795456205172, 0.049067674327418,
  -0.997290456678690, 0.073564563599667,
  -0.995184726672197, 0.098017140329561,
  -0.992479534598710, 0.122410675199216,
  -0.989176509964781, 0.146730474455362,
  -0.985277642388941, 0.170961888760301,
  -0.980785280403230, 0.195090322016128,
  -0.975702130038529, 0.219101240156870,
  -0.970031253194544, 0.242980179903264,
  -0.963776065795440, 0.266712757474898,
  -0.956940335732209, 0.290284677254462,
  -0.949528180593037, 0.313681740398891,
  -0.941544065183021, 0.336889853392220,
  -0.932992798834739, 0.359895036534988,
  -0.923879532511287, 0.382683432365090,
  -0.914209755703531, 0.405241314004990,
  -0.903989293123443, 0.427555093430282,
  -0.893224301195515, 0.449611329654607,
  -0.881921264348355, 0.471396736825998,
  -0.870086991108711, 0.492898192229784,
  -0.857728610000272, 0.514102744193222,
  -0.844853565249707, 0.534997619887097,
  -0.831469612302545, 0.555570233019602,
  -0.817584813151584, 0.575808191417845,
  -0.803207531480645, 0.595699304492433,
  -0.788346427626606, 0.615231590580627,
  -0.773010453362737, 0.634393284163645,
  -0.757208846506485, 0.653172842953777,
  -0.740951125354959, 0.671558954847018,
  -0.724247082951467, 0.689540544737067,
  -0.707106781186548, 0.707106781186547,
  -0.689540544737067, 0.724247082951467,
  -0.671558954847019, 0.740951125354959,
  -0.653172842953777, 0.757208846506484,
  -0.634393284163646, 0.773010453362737,
  -0.615231590580627, 0.788346427626606,
  -0.595699304492433, 0.803207531480645,
  -0.575808191417845, 0.817584813151584,
  -0.555570233019602, 0.831469612302545,
  -0.534997619887097, 0.844853565249707,
  -0.514102744193222, 0.857728610000272,
  -0.492898192229784, 0.870086991108711,
  -0.471396736825998, 0.881921264348355,
  -0.449611329654607, 0.893224301195515,
  -0.427555093430282, 0.903989293123443,
  -0.405241314004990, 0.914209755703530,
  -0.382683432365090, 0.923879532511287,
  -0.359895036534988, 0.932992798834739,
  -0.336889853392220, 0.941544065183021,
  -0.313681740398891, 0.949528180593037,
  -0.290284677254462, 0.956940335732209,
  -0.266712757474899, 0.963776065795440,
  -0.242980179903264, 0.970031253194544,
  -0.219101240156870, 0.975702130038528,
  -0.195090322016129, 0.980785280403230,
  -0.170961888760302, 0.985277642388941,
  -0.146730474455362, 0.989176509964781,
  -0.122410675199216, 0.992479534598710,
  -0.098017140329560, 0.995184726672197,
  -0.073564563599667, 0.997290456678690,
  -0.049067674327418, 0.998795456205172,
  -0.024541228522912, 0.999698818696204,
  -0.000000000000000, 1.000000000000000,
   0.024541228522912, 0.999698818696204,
   0.049067674327418, 0.998795456205172,
   0.073564563599667, 0.997290456678690,
   0.098017140329560, 0.995184726672197,
   0.122410675199216, 0.992479534598710,
   0.146730474455362, 0.989176509964781,
   0.170961888760301, 0.985277642388941,
   0.195090322016128, 0.980785280403230,
   0.219101240156870, 0.975702130038529,
   0.242980179903264, 0.970031253194544,
   0.266712757474898, 0.963776065795440,
   0.290284677254462, 0.956940335732209,
   0.313681740398891, 0.949528180593037,
   0.336889853392220, 0.941544065183021,
   0.359895036534988, 0.932992798834739,
   0.382683432365090, 0.923879532511287,
   0.405241314004990, 0.914209755703531,
   0.427555093430282, 0.903989293123443,
   0.449611329654607, 0.893224301195515,
   0.471396736825998, 0.881921264348355,
   0.492898192229784, 0.870086991108711,
   0.514102744193222, 0.857728610000272,
   0.534997619887097, 0.844853565249707,
   0.555570233019602, 0.831469612302545,
   0.575808191417845, 0.817584813151584,
   0.595699304492433, 0.803207531480645,
   0.615231590580627, 0.788346427626606,
   0.634393284163646, 0.773010453362737,
   0.653172842953777, 0.757208846506485,
   0.671558954847018, 0.740951125354959,
   0.689540544737067, 0.724247082951467,
   0.707106781186547, 0.707106781186548,
   0.724247082951467, 0.689540544737067,
   0.740951125354959, 0.671558954847019,
   0.757208846506484, 0.653172842953777,
   0.773010453362737, 0.634393284163646,
   0.788346427626606, 0.615231590580627,
   0.803207531480645, 0.595699304492433,
   0.817584813151584, 0.575808191417845,
   0.831469612302545, 0.555570233019602,
   0.844853565249707, 0.534997619887097,
   0.857728610000272, 0.514102744193222,
   0.870086991108711, 0.492898192229784,
   0.881921264348355, 0.471396736825998,
   0.893224301195515, 0.449611329654607,
   0.903989293123443, 0.427555093430283,
   0.914209755703530, 0.405241314004990,
   0.923879532511287, 0.382683432365090,
   0.932992798834739, 0.359895036534988,
   0.941544065183021, 0.336889853392220,
   0.949528180593037, 0.313681740398892,
   0.956940335732209, 0.290284677254462,
   0.963776065795440, 0.266712757474899,
   0.970031253194544, 0.242980179903264,
   0.975702130038528, 0.219101240156870,
   0.980785280403230, 0.195090322016129,
   0.985277642388941, 0.170961888760302,
   0.989176509964781, 0.146730474455362,
   0.992479534598710, 0.122410675199216,
   0.995184726672197, 0.098017140329561,
   0.997290456678690, 0.073564563599667,
   0.998795456205172, 0.049067674327418,
   0.999698818696204, 0.024541228522912
};

void initTwiddles() {
  static bool firstTime = true;
  if (firstTime) {
    firstTime = false;
    cudaMemcpyToSymbol(twiddleFactors,
                       twiddleFactorsHost,
                       kNumTwiddles * sizeof(facebook::cuda::Complex));
  }
}

} // anon namespace

}}} // namespace
